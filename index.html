<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Virginia Legends Cricket 2025</title>
<style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #f5f7fa, #c3cfe2);
      padding: 10px;
      margin: 0;
      text-align: center;
    }
    
    h1 {
      background: linear-gradient(to right, #ff6a00, #ee0979);
      color: white;
      padding: 20px;
      border-radius: 10px;
      font-size: 2em;
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    #resultsBox {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .result-card {
      background: #fff9c4;
      border-left: 5px solid #4caf50;
      border-radius: 8px;
      padding: 15px;
      max-width: 800px;
      margin: auto;
      font-size: 16px;
      line-height: 1.5;
      color: #333;
    }
    
    .group-section {
      margin: 30px auto;
      max-width: 95%;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .group-title {
      background: linear-gradient(to right, #42a5f5, #7e57c2);
      color: white;
      padding: 12px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      background: white;
    }
    
    th {
      background-color: #3949ab;
      color: white;
      padding: 10px;
      text-align: center;
      font-weight: 600;
      border: 1px solid #ccc;
    }
    
    td {
      padding: 10px;
      text-align: center;
      color: #333;
      border: 1px solid #ccc;
      background-color: #fafafa;
    }
    
    tr:nth-child(even) td {
      background-color: #f0f0f0;
    }
    
    tr:hover td {
      background-color: #e1bee7;
    }
    
    .nrr-cell {
      white-space: nowrap;
    }
    
    .knockout-section {
      margin: 30px auto;
      max-width: 95%;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
      overflow: hidden;
      transition: transform 0.2s ease;
      border: 1px solid #e0e0e0;
    }
    
    .knockout-section:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
    }
    
    .knockout-title {
      background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 50%, #1f1f1f 100%);
      color: #ffffff;
      padding: 20px;
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 2px;
      position: relative;
      overflow: hidden;
      border-bottom: 3px solid #ffd700;
    }
    
    .knockout-title::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,215,0,0.3), transparent);
      animation: shine 4s infinite;
    }
    
    .knockout-section table {
      background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
    }
    
    .knockout-section th {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      color: #ffffff;
      padding: 15px 12px;
      text-align: center;
      font-weight: 700;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      border: none;
      border-right: 1px solid rgba(255,255,255,0.1);
    }
    
    .knockout-section th:last-child {
      border-right: none;
    }
    
    .qualified-row {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
      color: #2c3e50 !important;
      font-weight: 600;
      animation: none;
      border-left: 4px solid #ffd700;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .qualified-row td {
      background: transparent !important;
      color: #2c3e50 !important;
      font-weight: 600;
      padding: 15px 12px;
      border-right: 1px solid rgba(0,0,0,0.05);
      font-size: 14px;
    }
    
    .qualified-row:hover {
      background: linear-gradient(135deg, #e3f2fd 0%, #f1f8e9 100%) !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.12);
    }
    
    .qualified-row:hover td {
      background: transparent !important;
      color: #1565c0 !important;
    }
    
    .qualified-row td:first-child {
      font-weight: 800;
      font-size: 16px;
      color: #ff6f00 !important;
    }
    
    .qualified-row td:nth-child(2) {
      font-weight: 700;
      font-size: 15px;
      color: #1565c0 !important;
    }
    
    @keyframes shine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    .playoff-section {
      margin: 30px auto;
      max-width: 95%;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      background: linear-gradient(145deg, #0a0e27 0%, #1a1f3a 50%, #2a2d47 100%);
      padding: 30px;
      transition: transform 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .playoff-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ff6f00, #ffc107, #ff5722, #e91e63, #9c27b0, #3f51b5, #2196f3);
      animation: rainbow 3s linear infinite;
    }
    
    @keyframes rainbow {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    
    .playoff-section:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
    }
    
    .playoff-title {
      background: linear-gradient(135deg, #ff6f00 0%, #ffc107 50%, #ff8f00 100%);
      color: white;
      padding: 20px;
      font-size: 28px;
      font-weight: 900;
      text-align: center;  
      border-radius: 15px;
      margin-bottom: 35px;
      text-transform: uppercase;
      letter-spacing: 3px;
      box-shadow: 0 8px 25px rgba(255, 111, 0, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .playoff-title::before {
      content: 'üèÜ';
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 32px;
      animation: bounce 2s infinite;
    }
    
    .playoff-title::after {
      content: 'üèÜ';
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 32px;
      animation: bounce 2s infinite 0.5s;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(-50%) scale(1); }
      40% { transform: translateY(-60%) scale(1.1); }
      60% { transform: translateY(-55%) scale(1.05); }
    }
    
    .bracket-round {
      margin-bottom: 40px;
      position: relative;
    }
    
    .bracket-round::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: linear-gradient(90deg, #ff6f00, #ffc107);
      border-radius: 2px;
    }
    
    .bracket-round h3 {
      color: #ffffff;
      font-size: 24px;
      margin-bottom: 25px;
      text-align: center;
      padding: 18px 25px;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      border-radius: 12px;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 800;
      border: 2px solid #ffc107;
      box-shadow: 0 6px 20px rgba(30, 60, 114, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .bracket-round h3::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,193,7,0.3), transparent);
      animation: shine 3s infinite;
    }
    
    .bracket-matches {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
      perspective: 1000px;
    }
    
    .bracket-match {
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      font-weight: 700;
      font-size: 16px;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      transform-style: preserve-3d;
      border: 2px solid transparent;
    }
    
    .bracket-match::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: inherit;
      border-radius: 15px;
      filter: blur(20px);
      opacity: 0.7;
      z-index: -1;
      transform: scale(1.05);
      transition: all 0.4s ease;
    }
    
    .bracket-match:hover {
      transform: translateY(-8px) rotateX(5deg);
      z-index: 10;
    }
    
    .bracket-match:hover::before {
      filter: blur(25px);
      opacity: 0.9;
      transform: scale(1.1);
    }
    
    .bracket-match.quarterfinal {
      background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 50%, #4caf50 100%);
      color: white;
      border: 2px solid #66bb6a;
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }
    
    .bracket-match.quarterfinal:hover {
      box-shadow: 0 15px 35px rgba(76, 175, 80, 0.6);
      border-color: #81c784;
    }
    
    .bracket-match.semifinal {
      background: linear-gradient(135deg, #e65100 0%, #f57c00 50%, #ff9800 100%);
      color: white;
      border: 2px solid #ffb74d;
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
    }
    
    .bracket-match.semifinal:hover {
      box-shadow: 0 15px 35px rgba(255, 152, 0, 0.6);
      border-color: #ffcc02;
    }
    
    .bracket-match.final {
      background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 50%, #f44336 100%);
      color: white;
      border: 3px solid #ef5350;
      box-shadow: 0 8px 25px rgba(244, 67, 54, 0.5);
      font-size: 20px;
      padding: 25px;
      position: relative;
    }
    
    .bracket-match.final::after {
      content: 'üëë';
      position: absolute;
      top: -10px;
      right: -10px;
      font-size: 24px;
      animation: rotate 3s linear infinite;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .bracket-match.final:hover {
      box-shadow: 0 15px 40px rgba(244, 67, 54, 0.7);
      border-color: #ff7043;
    }
    
    .match-vs {
      font-size: 14px;
      opacity: 0.8;
      margin: 8px 0;
      text-transform: lowercase;
      font-weight: 400;
    }
    
    .team-name {
      font-size: 18px;
      font-weight: 800;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    @media screen and (max-width: 768px) {
      body {
        padding: 5px;
      }
      h1 {
        font-size: 1.4em;
        padding: 15px;
      }
      .group-title {
        font-size: 16px;
      }
      table, th, td {
        font-size: 12px;
        padding: 6px;
      }
      .bracket-matches {
        grid-template-columns: 1fr;
      }
      .knockout-title, .playoff-title {
        font-size: 16px;
      }
    }
    
    @media screen and (max-width: 600px) {
      .result-card {
        font-size: 13px;
        padding: 10px;
      }
      table, th, td {
        font-size: 12px;
      }
      .group-title {
        font-size: 16px;
      }
    }
    
/* IPL-style enhancements for group tables */
.group-section table {
  border: 2px solid #673ab7;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(103, 58, 183, 0.3);
}

.group-section th {
  background: linear-gradient(to right, #512da8, #673ab7);
  color: white;
  text-transform: uppercase;
  font-size: 13px;
  padding: 10px;
  letter-spacing: 1px;
}

.group-section td {
  font-size: 13px;
  background: #f3e5f5;
  color: #311b92;
  padding: 8px;
}

.top-team-row {
  background: #d1c4e9 !important;
  font-weight: bold;
  color: #4a148c !important;
}

.bottom-team-row {
  background: #ffebee !important;
  color: #b71c1c !important;
  font-weight: 500;
}

/* Mobile responsiveness */
@media screen and (max-width: 768px) {
  .group-section table, .group-section th, .group-section td {
    font-size: 12px;
    padding: 6px;
  }
}

/* Knockout table fit-to-screen on all devices */
.knockout-section table {
  width: 100%;
  table-layout: fixed;
}

/* Consistent row heights */
.group-section table td, .group-section table th,
.knockout-section table td, .knockout-section table th {
  height: 40px;
  vertical-align: middle;
}

/* Top teams pastel blue highlight */
.qualified-row {
  background: #d6eaf8 !important;
  color: #154360 !important;
  font-weight: 600;
}

/* Mobile knockout table fix */
@media screen and (max-width: 768px) {
  .knockout-section table,
  .knockout-section th,
  .knockout-section td {
    font-size: 11px;
    padding: 4px;
    word-wrap: break-word;
    white-space: normal;
  }
}


/* Allow longer team names in knockout */
.knockout-section td:nth-child(2),
.knockout-section th:nth-child(2) {
  min-width: 110px;
  max-width: 150px;
  word-wrap: break-word;
  white-space: normal;
}


/* Flashing LIVE badge */
.live-badge {
  background: red;
  color: white;
  border: none;
  padding: 4px 8px;
  border-radius: 4px;
  font-weight: bold;
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* Highlight animation for updated results */
.new-update {
  animation: highlightFade 2s ease-in-out;
}
@keyframes highlightFade {
  0% { background-color: #fff3cd; }
  100% { background-color: transparent; }
}


/* Smooth fade-in for updated results */
.fade-in {
  animation: fadeInEffect 1.5s ease-in-out;
}
@keyframes fadeInEffect {
  0% { opacity: 0; transform: translateY(10px); }
  100% { opacity: 1; transform: translateY(0); }
}


/* Wider team name column */
.knockout-section td:nth-child(2),
.knockout-section th:nth-child(2) {
  min-width: 180px; /* was 110px */
  max-width: 250px;
  white-space: normal;
  word-wrap: break-word;
}

/* Narrower P, W, L, Pts columns */
.knockout-section td:nth-child(3),
.knockout-section td:nth-child(4),
.knockout-section td:nth-child(5),
.knockout-section td:nth-child(6),
.knockout-section th:nth-child(3),
.knockout-section th:nth-child(4),
.knockout-section th:nth-child(5),
.knockout-section th:nth-child(6) {
  width: 40px; /* smaller fixed width */
}


/* Center-align P, W, L, Pts columns */
.knockout-section td:nth-child(3),
.knockout-section td:nth-child(4),
.knockout-section td:nth-child(5),
.knockout-section td:nth-child(6),
.knockout-section th:nth-child(3),
.knockout-section th:nth-child(4),
.knockout-section th:nth-child(5),
.knockout-section th:nth-child(6) {
  text-align: center;
}


/* Narrower Rank column */
.knockout-section td:nth-child(1),
.knockout-section th:nth-child(1) {
  width: 40px;
  text-align: center;
}


/* Ensure team names fit horizontally */
.knockout-section td:nth-child(2),
.knockout-section th:nth-child(2) {
  white-space: nowrap; /* prevent wrapping */
  overflow: hidden; /* hide overflow */
  text-overflow: ellipsis; /* show ... if too long */
}


/* Expand team name on hover to show full text */
.knockout-section td:nth-child(2):hover {
  white-space: normal !important; /* allow wrapping */
  overflow: visible !important;
  background: #fff3cd; /* subtle highlight */
  position: relative;
  z-index: 2;
}


/* Narrower Rank, P, W, L columns */
.knockout-section td:nth-child(1),
.knockout-section th:nth-child(1),
.knockout-section td:nth-child(3),
.knockout-section th:nth-child(3),
.knockout-section td:nth-child(4),
.knockout-section th:nth-child(4),
.knockout-section td:nth-child(5),
.knockout-section th:nth-child(5) {
  width: 30px; /* very narrow */
  text-align: center;
}

/* Team names stay horizontal */
.knockout-section td:nth-child(2),
.knockout-section th:nth-child(2) {
  white-space: nowrap !important; /* prevent wrapping */
  overflow: hidden; /* hide overflow */
  text-overflow: ellipsis; /* add ... if too long */
}


/* Narrow all columns except Team name */
.knockout-section th:not(:nth-child(2)),
.knockout-section td:not(:nth-child(2)) {
  width: 40px; /* narrow */
  text-align: center;
}

/* Team name gets priority space */
.knockout-section th:nth-child(2),
.knockout-section td:nth-child(2) {
  min-width: 220px; /* bigger space */
  white-space: nowrap !important; /* keep horizontal */
  overflow: hidden;
  text-overflow: ellipsis;
}


/* Narrow all columns except Team name */
.knockout-section th:not(:nth-child(2)),
.knockout-section td:not(:nth-child(2)) {
  width: 40px; /* narrow */
  text-align: center;
}

/* Team name fully visible */
.knockout-section th:nth-child(2),
.knockout-section td:nth-child(2) {
  white-space: normal !important; /* allow wrapping */
  overflow: visible !important;
  text-overflow: unset !important;
}


/* Mobile-friendly knockout table adjustments */
@media screen and (max-width: 768px) {
  .knockout-section table {
    font-size: 12px;
  }
  .knockout-section th:not(:nth-child(2)),
  .knockout-section td:not(:nth-child(2)) {
    width: 30px !important; /* even narrower on mobile */
    padding: 4px !important;
  }
  .knockout-section th:nth-child(2),
  .knockout-section td:nth-child(2) {
    min-width: auto !important;
    white-space: normal !important; /* wrap if needed */
  }
}


/* Extra narrow P, W, L columns for better NRR visibility */
.knockout-section th:nth-child(3),
.knockout-section td:nth-child(3),
.knockout-section th:nth-child(4),
.knockout-section td:nth-child(4),
.knockout-section th:nth-child(5),
.knockout-section td:nth-child(5) {
  width: 25px !important;
  padding: 2px !important;
  text-align: center;
}


/* Narrower Pts column */
.knockout-section th:nth-child(6),
.knockout-section td:nth-child(6) {
  width: 35px !important;
  padding: 2px !important;
  text-align: center;
}


/* Wider NRR column */
.knockout-section th:nth-child(7),
.knockout-section td:nth-child(7) {
  width: 70px !important;
  padding: 2px 4px !important;
  text-align: center;
}


/* NRR column sized for 6 characters */
.knockout-section th:nth-child(7),
.knockout-section td:nth-child(7) {
  width: 85px !important; /* enough for 6 characters plus padding */
  padding: 2px 4px !important;
  text-align: center;
}


/* Team name wide enough for ~12 characters */
.knockout-section th:nth-child(2),
.knockout-section td:nth-child(2) {
  min-width: 160px !important; /* wider for 12 chars */
  white-space: nowrap !important;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* NRR column exactly for ~6 characters */
.knockout-section th:nth-child(7),
.knockout-section td:nth-child(7) {
  width: 65px !important; /* narrower for 6 chars */
  padding: 2px 4px !important;
  text-align: right; /* align numbers neatly */
  font-variant-numeric: tabular-nums; /* align decimal points */
}


/* Rank, P, W, L, PTS narrow */
.knockout-section th:nth-child(1),
.knockout-section td:nth-child(1),
.knockout-section th:nth-child(3),
.knockout-section td:nth-child(3),
.knockout-section th:nth-child(4),
.knockout-section td:nth-child(4),
.knockout-section th:nth-child(5),
.knockout-section td:nth-child(5),
.knockout-section th:nth-child(6),
.knockout-section td:nth-child(6) {
  width: 35px !important;
  text-align: center;
  padding: 2px !important;
}

/* Team name wide enough for 12+ characters */
.knockout-section th:nth-child(2),
.knockout-section td:nth-child(2) {
  min-width: 180px !important; /* wider to fit names */
  white-space: nowrap !important;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* NRR column exactly for 6 characters, centered and numeric aligned */
.knockout-section th:nth-child(7),
.knockout-section td:nth-child(7) {
  width: 65px !important;
  padding: 2px 4px !important;
  text-align: center;
  font-variant-numeric: tabular-nums; /* align decimals */
}


/* Narrow R, P, W, L, PTS columns */
.knockout-section th:nth-child(1),
.knockout-section td:nth-child(1),
.knockout-section th:nth-child(3),
.knockout-section td:nth-child(3),
.knockout-section th:nth-child(4),
.knockout-section td:nth-child(4),
.knockout-section th:nth-child(5),
.knockout-section td:nth-child(5),
.knockout-section th:nth-child(6),
.knockout-section td:nth-child(6) {
  width: 30px !important;
  text-align: center;
  padding: 2px !important;
}

/* Wider team name column (~200px) */
.knockout-section th:nth-child(2),
.knockout-section td:nth-child(2) {
  min-width: 200px !important;
  white-space: nowrap !important;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* NRR column exactly for 6 characters */
.knockout-section th:nth-child(7),
.knockout-section td:nth-child(7) {
  width: 65px !important;
  text-align: center;
  font-variant-numeric: tabular-nums; /* align decimal points */
  padding: 2px 4px !important;
}

/* Mobile-specific adjustments */
@media screen and (max-width: 768px) {
  .knockout-section th:nth-child(2),
  .knockout-section td:nth-child(2) {
    min-width: 180px !important; /* slightly less for small screens */
  }
  .knockout-section th:nth-child(7),
  .knockout-section td:nth-child(7) {
    width: 60px !important; /* NRR still fits 6 chars */
  }
}

</style>

<style>
@media screen and (max-width: 768px) {
  .team-popup {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    width: 90% !important;
    max-height: 70% !important;
    overflow-y: auto !important;
    font-size: 14px !important;
    z-index: 999999 !important;
    padding: 12px !important;
  }
}
</style>

</head>
<body>

<h1>Virginia Legends Cricket 2025</h1>
<div id="lastUpdated" style="text-align: center; color: #666; font-size: 14px; margin-bottom: 20px;"></div>

<div id="resultsBox">No results yet</div>
<div id="tables"></div>

<div id="knockoutSection"></div>
<div id="playoffBrackets"></div>

<section id="upload-section">
</section>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
    let allResults = [];
    let resultIndex = 0;
    let scrollInterval;

    function loadResults() {
      const input = document.getElementById("resultsFileInput");
      if (!input.files.length) {
        alert("Please select a match results CSV file.");
        return;
      }

      Papa.parse(input.files[0], {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          const data = results.data;
          allResults = [];

          data.forEach(row => {
            const line = `üèè <strong>Group ${row['Group'] || ''}</strong> ‚Äì
              <strong>${row['Team1'] || ''}</strong> ${row['Team1 Runs'] || 0}/${row['Wickets'] ?? '--'} (${(row['Overs'] ? parseFloat(row['Overs']).toFixed(1) : '--')} ov)
              vs
              <strong>${row['Team2'] || ''}</strong> ${row['Team2 Runs'] || 0}/${row['Wickets_1'] ?? '--'} (${(row['Overs_1'] ? parseFloat(row['Overs_1']).toFixed(1) : '--')} ov)
              ‚Äî Result: <strong>${row['Result'] || 'N/A'}</strong>`;
            allResults.push(line);
          });

          resultIndex = 0;
          displayNextResults();
          if (scrollInterval) clearInterval(scrollInterval);
          scrollInterval = setInterval(displayNextResults, 10000);
        }
      });
    }

    function displayNextResults() {
      const box = document.getElementById("resultsBox");
      if (allResults.length === 0) {
        box.innerHTML = "No match data available.";
        return;
      }

      let html = "";
      for (let i = 0; i < 2; i++) {
        const idx = (resultIndex + i) % allResults.length;
        html += `<div>${allResults[idx]}</div>`;
      }

      resultIndex = (resultIndex + 2) % allResults.length;
      
    let wrappedHTML = allResults.slice(resultIndex, resultIndex + 2).map(result => `
      <div class="result-card new-update fade-in">
        ${result}
      </div>
    `).join('');
    box.innerHTML = wrappedHTML;
    
    }
  </script>
<script>
  function loadCSV() {
    const input = document.getElementById('csvFileInput');
    if (!input.files.length) {
      alert('Please select a CSV file.');
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      const text = e.target.result;
      const rows = text.trim().split('\n').map(row => row.split(','));
      const headers = rows[0];
      const groupIndex = headers.indexOf("Group");
      const teamIndex = headers.indexOf("Team");
      const pointsIndex = headers.indexOf("Points");
      const nrrIndex = headers.indexOf("NRR");

      const visibleHeaders = headers.filter((_, i) => i !== groupIndex);
      const groupData = {};
      for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        const group = row[groupIndex];
        if (!groupData[group]) groupData[group] = [];
        groupData[group].push(row);
      }

      const tablesDiv = document.getElementById('tables');
      tablesDiv.innerHTML = '';

      for (const group in groupData) {
        const rows = groupData[group];
        rows.sort((a, b) => {
          let pointsDiff = parseInt(b[pointsIndex]) - parseInt(a[pointsIndex]);
          if (pointsDiff !== 0) return pointsDiff;
          return parseFloat(b[nrrIndex]) - parseFloat(a[nrrIndex]);
        });

        
    const topTeamNames = new Set([rows[0][teamIndex], rows[1]?.[teamIndex] || ""]);
    const medalMap = {};
    medalMap[rows[0][teamIndex]] = "ü•á ";
    if (rows.length > 1) {
      medalMap[rows[1][teamIndex]] = "ü•à ";
    }
    
        const bottomTeamNames = new Set([
          rows[rows.length - 1]?.[teamIndex],
          rows[rows.length - 2]?.[teamIndex]
        ]);

        let html = '<div class="group-section">';
        html += '<div class="group-title">Group ' + group + '</div>';
        html += '<div style="overflow-x:auto;"><table><thead><tr>';
        visibleHeaders.forEach(h => html += '<th>' + h + '</th>');
        html += '</tr></thead><tbody>';

        rows.forEach(row => {
          const team = row[teamIndex];
          let rowClass = '';
          if (topTeamNames.has(team)) rowClass = 'top-team-row';
          else if (bottomTeamNames.has(team)) rowClass = 'bottom-team-row';

          html += `<tr class="${rowClass}">`;
          row.forEach((cell, i) => {
            if (i !== groupIndex) {
              let cellContent = cell;
              if (headers[i] === "NRR") {
                cellContent = parseFloat(cell).toFixed(3);
              }
              
    if (headers[i] === "NRR") {
      html += `<td class='nrr-cell'>${cellContent}</td>`;
    } else {
      html += `<td>${cellContent}</td>`;
    }
    
            }
          });
          html += '</tr>';
        });

        html += '</tbody></table></div></div></div>';
        tablesDiv.innerHTML += html;
      }
    };
    reader.readAsText(input.files[0]);
  }
</script>
    
<script>
  
let previousResultsHTML = "";

function updateResultsBox(newHTML) {
  const box = document.getElementById("resultsBox");
  if (box.innerHTML.trim() !== newHTML.trim()) {
    // Data changed ‚Üí add fade-in effect
    box.innerHTML = newHTML;
    box.querySelectorAll('.result-card').forEach(card => {
      card.classList.add('fade-in');
    });
  } else {
    // Data unchanged ‚Üí keep it static
    box.innerHTML = newHTML;
  }
}


let previousKnockoutHTML = "";

function updateKnockoutSection(newHTML) {
  const knockoutDiv = document.getElementById("knockoutSection");
  if (knockoutDiv.innerHTML.trim() !== newHTML.trim()) {
    knockoutDiv.innerHTML = newHTML;
    knockoutDiv.querySelectorAll('table').forEach(tbl => {
      tbl.classList.add('fade-in');
    });
  } else {
    knockoutDiv.innerHTML = newHTML;
  }
}


let previousBracketsHTML = "";

function updatePlayoffBrackets(newHTML) {
  const bracketsDiv = document.getElementById("playoffBrackets");
  if (bracketsDiv.innerHTML.trim() !== newHTML.trim()) {
    bracketsDiv.innerHTML = newHTML;
    bracketsDiv.querySelectorAll('.playoff-section').forEach(section => {
      section.classList.add('fade-in');
    });
  } else {
    bracketsDiv.innerHTML = newHTML;
  }
}

function fetchAndLoadCSV() {
    // Update timestamp
    const now = new Date();
    document.getElementById('lastUpdated').innerHTML = `Last Updated: ${now.toLocaleString()} <button class="live-badge" style="margin-left:10px;">LIVE</button>`;
    
    fetch('https://raw.githubusercontent.com/Wick1366/solid-robot/main/tournament_results.csv')
      .then(response => response.text())
      .then(text => {
        const rows = text.trim().split('\n').map(row => row.split(','));
        const headers = rows[0];
        const groupIndex = headers.indexOf("Group");
        const teamIndex = headers.indexOf("Team");
        const pointsIndex = headers.indexOf("Points");
        const nrrIndex = headers.indexOf("NRR");

        const visibleHeaders = headers.filter((_, i) => i !== groupIndex);
        const groupData = {};
        for (let i = 1; i < rows.length; i++) {
          const row = rows[i];
          const group = row[groupIndex];
          if (!groupData[group]) groupData[group] = [];
          groupData[group].push(row);
        }

        // Generate knockout table and brackets
        generateKnockoutStage(groupData, headers, teamIndex, pointsIndex, nrrIndex);

        const tablesDiv = document.getElementById('tables');
        tablesDiv.innerHTML = '';

        for (const group in groupData) {
          const rows = groupData[group];
          rows.sort((a, b) => {
            let pointsDiff = parseInt(b[pointsIndex]) - parseInt(a[pointsIndex]);
            if (pointsDiff !== 0) return pointsDiff;
            return parseFloat(b[nrrIndex]) - parseFloat(a[nrrIndex]);
          });

          const topTeamNames = new Set([rows[0][teamIndex], rows[1]?.[teamIndex] || ""]);
          const bottomTeamNames = new Set([
            rows[rows.length - 1]?.[teamIndex],
            rows[rows.length - 2]?.[teamIndex]
          ]);

          let html = '<div class="group-section">';
          html += '<div class="group-title">Group ' + group + '</div>';
          html += '<div style="overflow-x:auto;"><table><thead><tr>';
          visibleHeaders.forEach(h => html += '<th>' + h + '</th>');
          html += '</tr></thead><tbody>';

          rows.forEach((row, index) => {
            const team = row[teamIndex];
            let rowClass = '';
            if (index < 2) rowClass = 'qualified-row'; // Top 2 qualify
            else if (topTeamNames.has(team)) rowClass = 'top-team-row';
            else if (bottomTeamNames.has(team)) rowClass = 'bottom-team-row';

            html += `<tr class="${rowClass}">`;
            row.forEach((cell, i) => {
              if (i !== groupIndex) {
                let cellContent = cell;
                if (headers[i] === "NRR") {
                  cellContent = parseFloat(cell).toFixed(3);
                }
                if (headers[i] === "NRR") {
                  html += `<td class='nrr-cell'>${cellContent}</td>`;
                } else {
                  html += `<td>${cellContent}</td>`;
                }
              }
            });
            html += '</tr>';
          });

          html += '</tbody></table></div></div></div>';
          tablesDiv.innerHTML += html;
        }
      });

    fetch('https://raw.githubusercontent.com/Wick1366/solid-robot/main/match_scores.csv')
      .then(response => response.text())
      .then(text => {
        const data = Papa.parse(text, { header: true, skipEmptyLines: true }).data;
        const box = document.getElementById("resultsBox");

        if (!data.length) {
          box.innerHTML = "No match data available.";
          return;
        }

        const results = data.map(row => `
          <div class="result-card new-update fade-in">
            üèè <strong>Group ${row['Group'] || ''}</strong> ‚Äì
            <strong>${row['Team1'] || ''}</strong> ${row['Team1 Runs'] || 0}/${row['Wickets'] ?? '--'} (${(row['Overs'] ? parseFloat(row['Overs']).toFixed(1) : '--')} ov)
            vs
            <strong>${row['Team2'] || ''}</strong> ${row['Team2 Runs'] || 0}/${row['Wickets_1'] ?? '--'} (${(row['Overs_1'] ? parseFloat(row['Overs_1']).toFixed(1) : '--')} ov)
            ‚Äî Result: <strong>${row['Result'] || 'N/A'}</strong>
          </div>
        `).join('');

        updateResultsBox(results);
      });
  }

  window.onload = fetchAndLoadCSV;
  setInterval(fetchAndLoadCSV, 60000); // every 60 seconds
  
  function generateKnockoutStage(groupData, headers, teamIndex, pointsIndex, nrrIndex) {
    const qualifiedTeams = [];
    
    // Get top 2 from each group
    for (const group in groupData) {
      const rows = groupData[group];
      rows.sort((a, b) => {
        let pointsDiff = parseInt(b[pointsIndex]) - parseInt(a[pointsIndex]);
        if (pointsDiff !== 0) return pointsDiff;
        return parseFloat(b[nrrIndex]) - parseFloat(a[nrrIndex]);
      });
      
      // Add top 2 teams with their group info
      if (rows[0]) qualifiedTeams.push({...rows[0], group: group, position: 1});
      if (rows[1]) qualifiedTeams.push({...rows[1], group: group, position: 2});
    }
    
    // Sort qualified teams by points, then NRR
    qualifiedTeams.sort((a, b) => {
      let pointsDiff = parseInt(b[pointsIndex]) - parseInt(a[pointsIndex]);
      if (pointsDiff !== 0) return pointsDiff;
      return parseFloat(b[nrrIndex]) - parseFloat(a[nrrIndex]);
    });
    
    // Generate knockout table
    generateKnockoutTable(qualifiedTeams, headers, teamIndex, pointsIndex, nrrIndex);
    
    // Generate playoff brackets
    generatePlayoffBrackets(qualifiedTeams, teamIndex);
  }
  
  function generateKnockoutTable(teams, headers, teamIndex, pointsIndex, nrrIndex) {
    const knockoutDiv = document.getElementById('knockoutSection');
    
    let html = '<div class="knockout-section">';
    html += '<div class="knockout-title">üèè Knockout Stage ‚Äì Current Standings & Brackets</div>';
    html += '<div style="overflow-x:auto;"><table><thead><tr>';
    html += '<th>R</th><th style="min-width: 110px;">Team</th><th>P</th><th>W</th><th>L</th><th>Pts</th><th>NRR</th>';
    html += '</tr></thead><tbody>';
    
    teams.forEach((team, index) => {
      html += `<tr class="qualified-row">`;
      html += `<td><strong>${index + 1}</strong></td>`;
      html += `<td><strong>${team[teamIndex]}</strong></td>`;
      html += ``;
      
      // Find the correct column indices - trying common variations
      const playedIndex = headers.indexOf("Mat");
      const wonIndex = headers.indexOf("W");
      const lostIndex = headers.indexOf("L");
      
      html += `<td>${playedIndex >= 0 ? team[playedIndex] : 'N/A'}</td>`;
      html += `<td>${wonIndex >= 0 ? team[wonIndex] : 'N/A'}</td>`;
      html += `<td>${lostIndex >= 0 ? team[lostIndex] : 'N/A'}</td>`;
      html += `<td>${team[pointsIndex]}</td>`;
      html += `<td class="nrr-cell">${parseFloat(team[nrrIndex]).toFixed(3)}</td>`;
      html += '</tr>';
    });
    
    html += '</tbody></table></div></div>';
    updateKnockoutSection(html);
  }
  
  function generatePlayoffBrackets(teams, teamIndex) {
    const bracketsDiv = document.getElementById('playoffBrackets');
    
    let html = '<div class="playoff-section">';
    html += '<div class="playoff-title">Playoff Brackets</div>';
    
    // Quarter Finals
    html += '<div class="bracket-round">';
    html += '<h3>‚ö° Quarter Finals</h3>';
    html += '<div class="bracket-matches">';
    
    if (teams.length >= 8) {
      html += `<div class="bracket-match quarterfinal">
        <div class="team-name">${teams[0][teamIndex]}</div>
        <div class="match-vs">vs</div>
        <div class="team-name">${teams[7][teamIndex]}</div>
        <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">QF1</div>
      </div>`;
      html += `<div class="bracket-match quarterfinal">
        <div class="team-name">${teams[1][teamIndex]}</div>
        <div class="match-vs">vs</div>
        <div class="team-name">${teams[6][teamIndex]}</div>
        <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">QF2</div>
      </div>`;
      html += `<div class="bracket-match quarterfinal">
        <div class="team-name">${teams[2][teamIndex]}</div>
        <div class="match-vs">vs</div>
        <div class="team-name">${teams[5][teamIndex]}</div>
        <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">QF3</div>
      </div>`;
      html += `<div class="bracket-match quarterfinal">
        <div class="team-name">${teams[3][teamIndex]}</div>
        <div class="match-vs">vs</div>
        <div class="team-name">${teams[4][teamIndex]}</div>
        <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">QF4</div>
      </div>`;
    }
    
    html += '</div></div>';
    
    // Semi Finals
    html += '<div class="bracket-round">';
    html += '<h3>üî• Semi Finals</h3>';
    html += '<div class="bracket-matches">';
    html += `<div class="bracket-match semifinal">
      <div class="team-name">Winner QF1</div>
      <div class="match-vs">vs</div>
      <div class="team-name">Winner QF4</div>
      <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">SF1</div>
    </div>`;
    html += `<div class="bracket-match semifinal">
      <div class="team-name">Winner QF2</div>
      <div class="match-vs">vs</div>
      <div class="team-name">Winner QF3</div>
      <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">SF2</div>
    </div>`;
    html += '</div></div>';
    
    // Final
    html += '<div class="bracket-round">';
    html += '<h3>üëë Grand Final</h3>';
    html += '<div class="bracket-matches">';
    html += `<div class="bracket-match final">
      <div class="team-name">Winner SF1</div>
      <div class="match-vs">vs</div>
      <div class="team-name">Winner SF2</div>
      <div style="margin-top: 15px; font-size: 14px; opacity: 0.9; letter-spacing: 2px;">üèÜ CHAMPION üèÜ</div>
    </div>`;
    html += '</div></div>';
    
    html += '</div>';
    updatePlayoffBrackets(html);
  }
</script>


<script>
function autoFitKnockoutTable() {
  const knockoutTable = document.querySelector('.knockout-section table');
  if (!knockoutTable) return;
  
  const headerCells = knockoutTable.querySelectorAll('thead th');
  const bodyRows = knockoutTable.querySelectorAll('tbody tr');

  headerCells.forEach((th, colIndex) => {
    let maxWidth = th.offsetWidth;

    // Measure width of each cell in the column
    bodyRows.forEach(row => {
      const cell = row.children[colIndex];
      if (cell) {
        const temp = document.createElement('span');
        temp.style.visibility = 'hidden';
        temp.style.whiteSpace = 'nowrap';
        temp.innerText = cell.innerText;
        document.body.appendChild(temp);
        const width = temp.offsetWidth + 16; // padding
        if (width > maxWidth) maxWidth = width;
        document.body.removeChild(temp);
      }
    });

    // Apply calculated width
    th.style.minWidth = maxWidth + 'px';
    headerCells.forEach((h, i) => {
      if (i === colIndex) {
        knockoutTable.querySelectorAll('tr').forEach(r => {
          if (r.children[colIndex]) {
            r.children[colIndex].style.minWidth = maxWidth + 'px';
          }
        });
      }
    });
  });

  // Keep numeric columns center aligned
  [0,2,3,4,5,6].forEach(idx => {
    knockoutTable.querySelectorAll('tr').forEach(row => {
      if (row.children[idx]) {
        row.children[idx].style.textAlign = 'center';
        row.children[idx].style.fontVariantNumeric = 'tabular-nums';
      }
    });
  });

  // Ensure team column uses extra space if available
  const tableWidth = knockoutTable.offsetWidth;
  const totalSetWidth = Array.from(headerCells).reduce((sum, th) => sum + parseInt(th.style.minWidth || 0), 0);
  if (totalSetWidth < tableWidth) {
    const teamCol = headerCells[1];
    const extra = tableWidth - totalSetWidth;
    const current = parseInt(teamCol.style.minWidth || 0);
    teamCol.style.minWidth = (current + extra) + 'px';
    knockoutTable.querySelectorAll('tr').forEach(row => {
      if (row.children[1]) {
        row.children[1].style.minWidth = (current + extra) + 'px';
      }
    });
  }
}

// Run after knockout table loads
const originalUpdateKnockoutSection = updateKnockoutSection;
updateKnockoutSection = function(newHTML) {
  originalUpdateKnockoutSection(newHTML);
  setTimeout(autoFitKnockoutTable, 200);
};
</script>


<script>
function autoFitGroupTables() {
  const groupTables = document.querySelectorAll('.group-section table');
  if (!groupTables.length) return;

  groupTables.forEach(table => {
    const headerCells = table.querySelectorAll('thead th');
    const bodyRows = table.querySelectorAll('tbody tr');

    headerCells.forEach((th, colIndex) => {
      let maxWidth = th.offsetWidth;

      // Measure width of each cell in the column
      bodyRows.forEach(row => {
        const cell = row.children[colIndex];
        if (cell) {
          const temp = document.createElement('span');
          temp.style.visibility = 'hidden';
          temp.style.whiteSpace = 'nowrap';
          temp.innerText = cell.innerText;
          document.body.appendChild(temp);
          const width = temp.offsetWidth + 16; // padding
          if (width > maxWidth) maxWidth = width;
          document.body.removeChild(temp);
        }
      });

      // Apply calculated width
      th.style.minWidth = maxWidth + 'px';
      table.querySelectorAll('tr').forEach(r => {
        if (r.children[colIndex]) {
          r.children[colIndex].style.minWidth = maxWidth + 'px';
        }
      });
    });

    // Keep numeric columns center aligned
    headerCells.forEach((_, idx) => {
      const headerText = headerCells[idx].innerText.toLowerCase();
      if (['r', 'p', 'w', 'l', 'pts', 'nrr'].some(label => headerText.includes(label))) {
        table.querySelectorAll('tr').forEach(row => {
          if (row.children[idx]) {
            row.children[idx].style.textAlign = 'center';
            row.children[idx].style.fontVariantNumeric = 'tabular-nums';
          }
        });
      }
    });
  });
}

// Override original update functions to also fit group tables
const originalLoadCSV = loadCSV;
loadCSV = function() {
  originalLoadCSV();
  setTimeout(autoFitGroupTables, 200);
};

const originalFetchAndLoadCSV = fetchAndLoadCSV;
fetchAndLoadCSV = function() {
  originalFetchAndLoadCSV();
  setTimeout(() => {
    autoFitGroupTables();
    autoFitKnockoutTable();
  }, 300);
};
</script>


<style>
@media screen and (max-width: 768px) {
  .group-section table, .knockout-section table {
    font-size: 12px; /* slightly smaller default for mobile */
  }
}
</style>

<script>
function adjustFontSizeToFit(tableSelector) {
  const table = document.querySelector(tableSelector);
  if (!table) return;
  
  const containerWidth = table.parentElement.offsetWidth;
  let tableWidth = table.offsetWidth;

  // If table is still wider than container, reduce font-size gradually
  let fontSize = parseInt(window.getComputedStyle(table).fontSize);
  while (tableWidth > containerWidth && fontSize > 9) {
    fontSize -= 1;
    table.style.fontSize = fontSize + 'px';
    tableWidth = table.offsetWidth;
  }
}

function adjustAllTablesForMobile() {
  if (window.innerWidth <= 768) {
    adjustFontSizeToFit('.knockout-section table');
    document.querySelectorAll('.group-section table').forEach((tbl, idx) => {
      adjustFontSizeToFit(`.group-section table:nth-of-type(${idx+1})`);
    });
  }
}

// Run after data load
const origFetchLoadCSV_mobile = fetchAndLoadCSV;
fetchAndLoadCSV = function() {
  origFetchLoadCSV_mobile();
  setTimeout(() => {
    autoFitGroupTables();
    autoFitKnockoutTable();
    adjustAllTablesForMobile();
  }, 400);
};
</script>


<style>
/* Smooth transition for font size changes */
.group-section table, .knockout-section table {
  transition: font-size 0.3s ease-in-out;
}
</style>


<style>
/* Tooltip styling */
.team-tooltip {
  position: relative;
  cursor: pointer;
}

.team-tooltip:hover::after,
.team-tooltip:focus::after {
  content: attr(data-fullname);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.85);
  color: #fff;
  padding: 5px 8px;
  border-radius: 4px;
  white-space: nowrap;
  font-size: 12px;
  z-index: 9999;
  opacity: 1;
  pointer-events: none;
}

.team-tooltip::after {
  opacity: 0;
  transition: opacity 0.2s ease-in-out;
}
</style>

<script>
function addTeamNameTooltips() {
  document.querySelectorAll('.knockout-section table tbody tr td:nth-child(2), .group-section table tbody tr td:nth-child(1)')
    .forEach(cell => {
      const fullText = cell.innerText.trim();
      if (fullText.length > 0) {
        cell.classList.add('team-tooltip');
        cell.setAttribute('data-fullname', fullText);
      }
    });
}

// Extend existing data load hooks
const originalFetchLoadCSV_tooltip = fetchAndLoadCSV;
fetchAndLoadCSV = function() {
  originalFetchLoadCSV_tooltip();
  setTimeout(() => {
    autoFitGroupTables();
    autoFitKnockoutTable();
    adjustAllTablesForMobile();
    addTeamNameTooltips();
  }, 500);
};
</script>


<style>
/* Floating popup styling */
.team-popup {
  position: absolute;
  background: white;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  padding: 8px 10px;
  font-size: 13px;
  max-width: 250px;
  z-index: 99999;
}
.team-popup h4 {
  margin: 0 0 5px;
  font-size: 14px;
  font-weight: bold;
  color: #333;
}
.team-popup div {
  margin-bottom: 4px;
  border-bottom: 1px solid #eee;
  padding-bottom: 2px;
}
</style>

<script>
let teamMatchHistory = {};
let activePopup = null;

function storeGroupStageResultsFromCSV(data) {
  teamMatchHistory = {};
  data.forEach(row => {
    if (row['Group']) { // Only group stage matches have 'Group'
      [row['Team1'], row['Team2']].forEach(team => {
        if (!teamMatchHistory[team]) teamMatchHistory[team] = [];
      });
      // Store both perspectives
      teamMatchHistory[row['Team1']].push({
        opponent: row['Team2'],
        score: `${row['Team1 Runs'] || 0}/${row['Wickets'] ?? '--'} (${row['Overs'] || '--'} ov)`,
        oppScore: `${row['Team2 Runs'] || 0}/${row['Wickets_1'] ?? '--'} (${row['Overs_1'] || '--'} ov)`,
        result: row['Result'] || 'N/A'
      });
      teamMatchHistory[row['Team2']].push({
        opponent: row['Team1'],
        score: `${row['Team2 Runs'] || 0}/${row['Wickets_1'] ?? '--'} (${row['Overs_1'] || '--'} ov)`,
        oppScore: `${row['Team1 Runs'] || 0}/${row['Wickets'] ?? '--'} (${row['Overs'] || '--'} ov)`,
        result: row['Result'] || 'N/A'
      });
    }
  });
}

function showTeamPopup(cell, teamName) {
  hideTeamPopup();
  if (!teamMatchHistory[teamName] || teamMatchHistory[teamName].length === 0) return;

  const popup = document.createElement('div');
  popup.className = 'team-popup';
  popup.innerHTML = `<h4>${teamName} - Recent Group Matches</h4>`;

  teamMatchHistory[teamName].slice(0,5).forEach(match => {
    popup.innerHTML += `<div>
      vs <strong>${match.opponent}</strong><br>
      ${match.score} <br>
      ${match.oppScore} <br>
      <em>${match.result}</em>
    </div>`;
  });

  document.body.appendChild(popup);

  // Position near cell
  const rect = cell.getBoundingClientRect();
  popup.style.top = `${rect.bottom + window.scrollY + 5}px`;
  popup.style.left = `${rect.left + window.scrollX}px`;

  activePopup = popup;
}

function hideTeamPopup() {
  if (activePopup) {
    activePopup.remove();
    activePopup = null;
  }
}

// Add click listeners to knockout team cells
function enableTeamPopups() {
  document.querySelectorAll('.knockout-section table tbody tr td:nth-child(2)').forEach(cell => {
    const teamName = cell.innerText.trim();
    if (!teamName) return;
    cell.addEventListener('click', (e) => {
      e.stopPropagation();
      if (activePopup) {
        hideTeamPopup();
      } else {
        showTeamPopup(cell, teamName);
      }
    });
  });

  // Hide popup on outside click
  document.addEventListener('click', () => hideTeamPopup());
}

// Extend fetchAndLoadCSV to store results and enable popups
const origFetchAndLoadCSV_popup = fetchAndLoadCSV;
fetchAndLoadCSV = function() {
  origFetchAndLoadCSV_popup();
  fetch('https://raw.githubusercontent.com/Wick1366/solid-robot/main/match_scores.csv')
    .then(r => r.text())
    .then(text => {
      const data = Papa.parse(text, { header: true, skipEmptyLines: true }).data;
      storeGroupStageResultsFromCSV(data);
      setTimeout(() => {
        enableTeamPopups();
      }, 500);
    });
};
</script>

</body>
</html>
